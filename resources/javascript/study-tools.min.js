!function(e,t){"use strict";Genki.tools={type:"",addRow:function(e){for(var t=e.parentNode.cloneNode(!0),o=e.parentNode.parentNode,l=t.querySelectorAll("input, textarea"),i=l.length;i-- >0;)"checkbox"==l[i].type?l[i].checked=!1:l[i].value="";o.appendChild(t),o.scrollTop=9999,this.updateJSON()},removeRow:function(e){e.parentNode.parentNode.removeChild(e.parentNode),this.updateJSON()},updateUI:function(){var e=t.getElementById("study-tool-json");e.value||(e.value="quiz"==this.type?'[{"question":"","answers":[""]}]':"fill"==this.type?'{"quiz":""}':'{"":""}');var o,l,i,n,a,s=JSON.parse(e.value),u='<button class="button row-add" title="add" onclick="Genki.tools.addRow(this);"><i class="fa">&#xf067;</i></button><button class="button row-remove" title="remove" onclick="Genki.tools.removeRow(this);"><i class="fa">&#xf068;</i></button>',r="";if("vocab"==this.type)for(o in s)r+='<li class="item-row"><input type="text" placeholder="word/kanji" oninput="Genki.tools.updateJSON();" value="'+(/\|/.test(o)?o.split("|")[0]:o)+'">&nbsp;<input type="text" placeholder="furigana (optional)" oninput="Genki.tools.updateJSON();" value="'+(/\|/.test(o)?o.split("|")[1]:"")+'">&nbsp;<input type="text" placeholder="definition/kana" oninput="Genki.tools.updateJSON();" value="'+s[o]+'">&nbsp;'+u+"</li>";else if("spelling"==this.type)for(o in s)r+='<li class="item-row"><input type="text" placeholder="word/kanji" oninput="Genki.tools.updateJSON();" value="'+o+'">&nbsp;<input type="text" placeholder="furigana (optional)" oninput="Genki.tools.updateJSON();" value="'+(s[o]?s[o]:"")+'">&nbsp;'+u+"</li>";else if("quiz"==this.type)for(o=0,l=s.length;o<l;o++){for(a="",i=0,n=s[o].answers.length;i<n;i++)a+='<li class="quiz-answer"><input type="checkbox" title="Correct answer" onchange="Genki.tools.updateJSON();"'+(/^A/.test(s[o].answers[i])?" checked":"")+'><input type="text" placeholder="answer" oninput="Genki.tools.updateJSON();" value="'+(/^A|!/.test(s[o].answers[i])?s[o].answers[i].slice(1):s[o].answers[i])+'">'+u+"</li>";r+='<li class="item-row question-row"><textarea placeholder="question" oninput="Genki.tools.updateJSON();">'+s[o].question+"</textarea>"+u+"<ol>"+a+"</ol></li>"}else"fill"==this.type&&(r='<li class="item-row"><textarea oninput="Genki.tools.updateJSON();">'+s.quiz+"</textarea></li>");t.getElementById("study-tool-ui").innerHTML=r,"quiz"==Genki.tools.type&&CreateCustomInputs()},updateJSON:function(){var e,o,l,i,n,a,s=t.getElementById("study-tool-ui").querySelectorAll(".item-row"),u=0,r=s.length,c={};if("vocab"==this.type)for(;u<r;u++)c[(l=s[u].getElementsByTagName("INPUT"))[0].value+(l[1].value?"|"+l[1].value:"")]=l[2].value;else if("spelling"==this.type)for(;u<r;u++)c[(l=s[u].getElementsByTagName("INPUT"))[0].value]=l[1].value;else if("quiz"==this.type)for(c=[];u<r;u++){for(n=[],e=0,o=(a=s[u].querySelectorAll(".quiz-answer")).length;e<o;e++)l=a[e].getElementsByTagName("INPUT"),n[e]=(l[0].checked?"A":"")+(!l[0].checked&&/^A/.test(l[1].value)?"!":"")+l[1].value;c[u]={question:s[u].getElementsByTagName("TEXTAREA")[0].value,answers:n}}else"fill"==this.type&&(c.quiz=s[u].getElementsByTagName("TEXTAREA")[0].value);i=t.getElementById("prettyCode").checked?JSON.stringify(c,"","  "):JSON.stringify(c),t.getElementById("study-tool-json").value=i,t.getElementById("downloadCode").href="data:,"+encodeURIComponent(i.replace(/\n/g,"\r\n")),storageOK&&(localStorage[{vocab:"customVocab",spelling:"customSpelling",quiz:"customQuiz",fill:"customWrittenQuiz"}[this.type]]=i)},restore:function(){var e={vocab:"customVocab",spelling:"customSpelling",quiz:"customQuiz",fill:"customWrittenQuiz"}[this.type];storageOK&&localStorage[e]?(t.getElementById("study-tool-json").value=localStorage[e],this.updateUI(),this.updateJSON()):this.updateJSON()},study:function(){t.getElementById("noStudyWarning").checked?this.begin():GenkiModal.open({title:"Ready to Study?",content:'Are you sure you\'re ready to study? Your custom exercise will be temporarily saved to the browser cache, however, if you want to use it again later, click "cancel", and then click "Save" to save it to a text document. (click "do not warn me" to disable this message)'+(navigator.cookieEnabled&&!offlineEdge?"":'<br><br><div style="color:#F00;font-weight:bold;">WARNING: Cookies are blocked by your browser, so your custom exercise will NOT be saved. Please click "close" and then click "Save" to backup your custom exercise.</div>'),keepOpen:"vocab"==Genki.tools.type,callback:Genki.tools.begin})},begin:function(){var e=Genki.tools.type,o=t.getElementById("study-tool-json").value.replace(/<script.*?>/g,"<span>").replace(/<\/script>/g,"</span>").replace(/ on.*?=\\".*?\\"/g,"");t.getElementById("study-tool-editor").style.display="none",t.getElementById("exercise").style.display="","vocab"==e?Genki.generateQuiz({format:"vocab",type:["drag","multi","writing","fill"],info:[Genki.lang.std_drag,Genki.lang.vocab_multi,Genki.lang.vocab_writing,Genki.lang.vocab_fill],quizlet:JSON.parse(o)}):"spelling"==e?Genki.generateQuiz({type:"writing",info:"Practice spelling the following words.",columns:+t.getElementById("spellingColumns").value,quizlet:JSON.parse(o)}):"quiz"==e?Genki.generateQuiz({type:"multi",info:"Answer the following questions.",quizlet:JSON.parse(o)}):"fill"==e&&Genki.generateQuiz({type:"fill",info:"Answer the following questions.",quizlet:JSON.parse(o).quiz})},importSnippet:function(e){GenkiModal.open({title:"Import Snippet?",content:"Are you sure you want to import this snippet? It will overwrite your current quiz settings.",callback:function(){t.querySelector("#study-tool-ui textarea").value=t.getElementById(e).value,Genki.tools.updateJSON(),Genki.scrollTo("#quiz-settings")}})},loadCode:function(e,o){var l=o?e:e.files[0],i=new FileReader;i.onload=function(l){t.getElementById("study-tool-json").value=l.target.result,o||(e.value=""),Genki.tools.updateUI(),Genki.tools.updateJSON()},i.readAsText(l,"UTF-8")},dropFile:function(e){Genki.tools.loadCode(e.dataTransfer.files[0],!0),e.preventDefault()},settings:{prettify:function(e){this.handleCheckbox(e),Genki.tools.updateJSON()},handleCheckbox:function(e,t){t?e.checked="true"==t:storageOK&&(localStorage[e.id]=e.checked)},restore:function(){if(storageOK)for(var e=["noStudyWarning","prettyCode"],o=0,l=e.length;o<l;o++)localStorage[e[o]]&&this.handleCheckbox(t.getElementById(e[o]),localStorage[e[o]])}},finishedLoading:function(){CreateCustomInputs();var e=t.querySelector(".loading");e.className=e.className.replace("loading","")}},t.getElementById("study-tool-editor").appendChild(t.querySelector(".more-exercises").cloneNode(!0))}(window,document);