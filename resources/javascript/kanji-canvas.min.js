!function(a,n){"use strict";"Copyright (c) 2019 Dominik Klein, Kanji Canvas (http://github.com/asdfjkl/kanjicanvas)";a.KanjiCanvas=new Object,KanjiCanvas.refPatterns=[],KanjiCanvas.darkMode=!!n.querySelector(".dark-mode"),KanjiCanvas.firefox=/Firefox/.test(navigator.userAgent),KanjiCanvas.strokeColors=["#bf0000","#bf5600","#bfac00","#7cbf00","#26bf00","#00bf2f","#00bf85","#00a2bf","#004cbf","#0900bf","#5f00bf","#b500bf","#bf0072","#bf001c","#bf2626","#bf6b26","#bfaf26","#89bf26","#44bf26","#26bf4c","#26bf91","#26a8bf","#2663bf","#2d26bf","#7226bf","#b726bf","#bf2682","#bf263d","#bf4c4c","#bf804c"],KanjiCanvas.init=function(a){KanjiCanvas["canvas_"+a]=n.getElementById(a),KanjiCanvas["canvas_"+a].tabIndex=0,KanjiCanvas["ctx_"+a]=KanjiCanvas["canvas_"+a].getContext("2d"),KanjiCanvas["w_"+a]=KanjiCanvas["canvas_"+a].width,KanjiCanvas["h_"+a]=KanjiCanvas["canvas_"+a].height,KanjiCanvas["flagOver_"+a]=!1,KanjiCanvas["flagDown_"+a]=!1,KanjiCanvas["prevX_"+a]=0,KanjiCanvas["currX_"+a]=0,KanjiCanvas["prevY_"+a]=0,KanjiCanvas["currY_"+a]=0,KanjiCanvas["dot_flag_"+a]=!1,KanjiCanvas["recordedPattern_"+a]=new Array,KanjiCanvas["currentLine_"+a]=null,KanjiCanvas.drawGuide(a),KanjiCanvas["canvas_"+a].addEventListener("mousemove",function(n){KanjiCanvas.findxy("move",n,a)},!1),KanjiCanvas["canvas_"+a].addEventListener("mousedown",function(n){KanjiCanvas.findxy("down",n,a)},!1),KanjiCanvas["canvas_"+a].addEventListener("mouseup",function(n){KanjiCanvas.findxy("up",n,a)},!1),KanjiCanvas["canvas_"+a].addEventListener("mouseout",function(n){KanjiCanvas.findxy("out",n,a)},!1),KanjiCanvas["canvas_"+a].addEventListener("mouseover",function(n){KanjiCanvas.findxy("over",n,a)},!1),KanjiCanvas["canvas_"+a].addEventListener("touchmove",function(n){KanjiCanvas.findxy("move",n,a)},!1),KanjiCanvas["canvas_"+a].addEventListener("touchstart",function(n){KanjiCanvas.findxy("down",n,a)},!1),KanjiCanvas["canvas_"+a].addEventListener("touchend",function(n){KanjiCanvas.findxy("up",n,a)},!1)},KanjiCanvas.draw=function(a,n){KanjiCanvas["ctx_"+a].beginPath(),KanjiCanvas["ctx_"+a].moveTo(KanjiCanvas["prevX_"+a],KanjiCanvas["prevY_"+a]),KanjiCanvas["ctx_"+a].lineTo(KanjiCanvas["currX_"+a],KanjiCanvas["currY_"+a]),KanjiCanvas["ctx_"+a].strokeStyle=n||(KanjiCanvas.darkMode?"#AAA":"#333"),KanjiCanvas["ctx_"+a].lineCap="round",KanjiCanvas["ctx_"+a].lineWidth=4,KanjiCanvas["ctx_"+a].stroke(),KanjiCanvas["ctx_"+a].closePath()},KanjiCanvas.drawGuide=function(a){if(KanjiCanvas["canvas_"+a].dataset.kanji){if("false"==KanjiCanvas["canvas_"+a].dataset.guide)return;var n=KanjiCanvas["canvas_"+a].dataset.size?KanjiCanvas["canvas_"+a].dataset.size:175;KanjiCanvas["ctx_"+a].font=n+"px "+(KanjiCanvas["canvas_"+a].dataset.font?KanjiCanvas["canvas_"+a].dataset.font:"'メイリオ', 'Meiryo', 'Osaka', 'ＭＳ Ｐゴシック', 'MS PGothic', 'ヒラギノ角ゴ Pro W3', 'Hiragino Kaku Gothic Pro', Arial, sans-serif"),KanjiCanvas["ctx_"+a].textBaseline="middle",KanjiCanvas["ctx_"+a].fillStyle=KanjiCanvas.darkMode?"#222":"#DDD",KanjiCanvas["ctx_"+a].fillText(KanjiCanvas["canvas_"+a].dataset.kanji,KanjiCanvas["canvas_"+a].width/2-n/2,KanjiCanvas["canvas_"+a].height/2+(KanjiCanvas.firefox?n/("true"==KanjiCanvas["canvas_"+a].dataset.kana?12:6):0))}},KanjiCanvas.deleteLast=function(a){KanjiCanvas["ctx_"+a].clearRect(0,0,KanjiCanvas["w_"+a],KanjiCanvas["h_"+a]),KanjiCanvas.drawGuide(a);for(var n=0;n<KanjiCanvas["recordedPattern_"+a].length-1;n++)for(var i=KanjiCanvas["recordedPattern_"+a][n],e=0;e<i.length-1;e++)KanjiCanvas["prevX_"+a]=i[e][0],KanjiCanvas["prevY_"+a]=i[e][1],KanjiCanvas["currX_"+a]=i[e+1][0],KanjiCanvas["currY_"+a]=i[e+1][1],KanjiCanvas.draw(a);KanjiCanvas["recordedPattern_"+a].pop()},KanjiCanvas.erase=function(a){KanjiCanvas["ctx_"+a].clearRect(0,0,KanjiCanvas["w_"+a],KanjiCanvas["h_"+a]),KanjiCanvas.drawGuide(a),KanjiCanvas["recordedPattern_"+a].length=0},KanjiCanvas.findxy=function(a,n,i){var e=n.changedTouches?n.changedTouches[0]:null;if(e&&n.preventDefault(),"down"==a){var s=KanjiCanvas["canvas_"+i].getBoundingClientRect();KanjiCanvas["prevX_"+i]=KanjiCanvas["currX_"+i],KanjiCanvas["prevY_"+i]=KanjiCanvas["currY_"+i],KanjiCanvas["currX_"+i]=(e?e.clientX:n.clientX)-s.left,KanjiCanvas["currY_"+i]=(e?e.clientY:n.clientY)-s.top,KanjiCanvas["currentLine_"+i]=new Array,KanjiCanvas["currentLine_"+i].push([KanjiCanvas["currX_"+i],KanjiCanvas["currY_"+i]]),KanjiCanvas["flagDown_"+i]=!0,KanjiCanvas["flagOver_"+i]=!0,KanjiCanvas["dot_flag_"+i]=!0,KanjiCanvas["dot_flag_"+i]&&(KanjiCanvas["ctx_"+i].beginPath(),KanjiCanvas["ctx_"+i].fillRect(KanjiCanvas["currX_"+i],KanjiCanvas["currY_"+i],2,2),KanjiCanvas["ctx_"+i].closePath(),KanjiCanvas["dot_flag_"+i]=!1)}if("up"==a&&(KanjiCanvas["flagDown_"+i]=!1,1==KanjiCanvas["flagOver_"+i]&&KanjiCanvas["recordedPattern_"+i].push(KanjiCanvas["currentLine_"+i])),"out"==a&&(KanjiCanvas["flagOver_"+i]=!1,1==KanjiCanvas["flagDown_"+i]&&KanjiCanvas["recordedPattern_"+i].push(KanjiCanvas["currentLine_"+i]),KanjiCanvas["flagDown_"+i]=!1),"move"==a&&KanjiCanvas["flagOver_"+i]&&KanjiCanvas["flagDown_"+i]){s=KanjiCanvas["canvas_"+i].getBoundingClientRect();KanjiCanvas["prevX_"+i]=KanjiCanvas["currX_"+i],KanjiCanvas["prevY_"+i]=KanjiCanvas["currY_"+i],KanjiCanvas["currX_"+i]=(e?e.clientX:n.clientX)-s.left,KanjiCanvas["currY_"+i]=(e?e.clientY:n.clientY)-s.top,KanjiCanvas["currentLine_"+i].push([KanjiCanvas["prevX_"+i],KanjiCanvas["prevY_"+i]]),KanjiCanvas["currentLine_"+i].push([KanjiCanvas["currX_"+i],KanjiCanvas["currY_"+i]]),KanjiCanvas.draw(i)}},KanjiCanvas.redraw=function(a,i,e){var s=!!KanjiCanvas["canvas_"+a].dataset.strokesAnswer;KanjiCanvas["ctx_"+a].clearRect(0,0,KanjiCanvas["w_"+a],KanjiCanvas["h_"+a]),i&&!KanjiCanvas.quizOver&&!s&&KanjiCanvas.drawGuide(a);for(var r=0;r<KanjiCanvas["recordedPattern_"+a].length;r++)for(var t=KanjiCanvas["recordedPattern_"+a][r],v=0;v<t.length-1;v++)KanjiCanvas["prevX_"+a]=t[v][0],KanjiCanvas["prevY_"+a]=t[v][1],KanjiCanvas["currX_"+a]=t[v+1][0],KanjiCanvas["currY_"+a]=t[v+1][1],KanjiCanvas.draw(a,!i||KanjiCanvas.quizOver||s?KanjiCanvas.strokeColors[r]:null);if(e){var C=n.querySelector(".drawing-quiz")?15:20;for(r=0;r<KanjiCanvas["recordedPattern_"+a].length;r++){var j=(t=KanjiCanvas["recordedPattern_"+a][r])[Math.floor(t.length/2)][0]+5,K=t[Math.floor(t.length/2)][1]-5;KanjiCanvas["ctx_"+a].font=C.toString()+"px Arial",KanjiCanvas["ctx_"+a].lineWidth=3,KanjiCanvas["ctx_"+a].strokeStyle=KanjiCanvas.alterHex(KanjiCanvas.strokeColors[r]?KanjiCanvas.strokeColors[r]:"#333333",60,"dec"),KanjiCanvas["ctx_"+a].strokeText((r+1).toString(),j,K),KanjiCanvas["ctx_"+a].fillStyle=KanjiCanvas.strokeColors[r]?KanjiCanvas.strokeColors[r]:"#333",KanjiCanvas["ctx_"+a].fillText((r+1).toString(),j,K)}}i||(KanjiCanvas["canvas_"+a].dataset.strokesAnswer=r)},KanjiCanvas.alterHex=function(a,n,i){for(var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a),s=[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)],r=0,t=s.length;r<t;r++){switch(i){case"inc":s[r]=(s[r]+n>255?255:s[r]+n).toString(16);break;case"dec":s[r]=(s[r]-n<0?0:s[r]-n).toString(16)}1==s[r].length&&(s[r]=s[r]+"0")}return"#"+s.join("")},KanjiCanvas.normalizeLinear=function(a){var n=new Array;KanjiCanvas.newHeight=256,KanjiCanvas.newWidth=256,KanjiCanvas.xMin=256,KanjiCanvas.xMax=0,KanjiCanvas.yMin=256,KanjiCanvas.yMax=0;for(var i=0;i<KanjiCanvas["recordedPattern_"+a].length;i++)for(var e=KanjiCanvas["recordedPattern_"+a][i],s=0;s<e.length;s++)KanjiCanvas.x=e[s][0],KanjiCanvas.y=e[s][1],KanjiCanvas.x<KanjiCanvas.xMin&&(KanjiCanvas.xMin=KanjiCanvas.x),KanjiCanvas.x>KanjiCanvas.xMax&&(KanjiCanvas.xMax=KanjiCanvas.x),KanjiCanvas.y<KanjiCanvas.yMin&&(KanjiCanvas.yMin=KanjiCanvas.y),KanjiCanvas.y>KanjiCanvas.yMax&&(KanjiCanvas.yMax=KanjiCanvas.y);KanjiCanvas.oldHeight=Math.abs(KanjiCanvas.yMax-KanjiCanvas.yMin),KanjiCanvas.oldWidth=Math.abs(KanjiCanvas.xMax-KanjiCanvas.xMin);for(i=0;i<KanjiCanvas["recordedPattern_"+a].length;i++){e=KanjiCanvas["recordedPattern_"+a][i];var r=new Array;for(s=0;s<e.length;s++)KanjiCanvas.x=e[s][0],KanjiCanvas.y=e[s][1],KanjiCanvas.xNorm=(KanjiCanvas.x-KanjiCanvas.xMin)*(KanjiCanvas.newWidth/KanjiCanvas.oldWidth),KanjiCanvas.yNorm=(KanjiCanvas.y-KanjiCanvas.yMin)*(KanjiCanvas.newHeight/KanjiCanvas.oldHeight),r.push([KanjiCanvas.xNorm,KanjiCanvas.yNorm]);n.push(r)}KanjiCanvas["recordedPattern_"+a]=n,KanjiCanvas.redraw(a)},KanjiCanvas.m10=function(a){for(var n=0,i=0;i<a.length;i++)for(var e=a[i],s=0;s<e.length;s++)n+=e[s][0];return n},KanjiCanvas.m01=function(a){for(var n=0,i=0;i<a.length;i++)for(var e=a[i],s=0;s<e.length;s++)n+=e[s][1];return n},KanjiCanvas.m00=function(a){for(var n=0,i=0;i<a.length;i++){n+=a[i].length}return n},KanjiCanvas.mu20=function(a,n){for(var i=0,e=0;e<a.length;e++)for(var s=a[e],r=0;r<s.length;r++){var t=s[r][0]-n;i+=t*t}return i},KanjiCanvas.mu02=function(a,n){for(var i=0,e=0;e<a.length;e++)for(var s=a[e],r=0;r<s.length;r++){var t=s[r][1]-n;i+=t*t}return i},KanjiCanvas.aran=function(a,n){var i=0;i=n>a?a/n:n/a;var e=Math.PI/2*i,s=Math.sin(e);Math.sqrt(s);return Math.sqrt(Math.sin(Math.PI/2*i))},KanjiCanvas.chopOverbounds=function(a){for(var n=new Array,i=0;i<a.length;i++){for(var e=a[i],s=new Array,r=0;r<e.length;r++){var t=e[r][0],v=e[r][1];t<0&&(t=0),t>=256&&(t=255),v<0&&(v=0),v>=256&&(v=255),s.push([t,v])}n.push(s)}return n},KanjiCanvas.transform=function(a,n,i){for(var e=new Array,s=0;s<a.length;s++){for(var r=a[s],t=new Array,v=0;v<r.length;v++){var C=r[v][0]+n,j=r[v][1]+i;t.push([C,j])}e.push(t)}return e},KanjiCanvas.momentNormalize=function(a){KanjiCanvas.newHeight=256,KanjiCanvas.newWidth=256,KanjiCanvas.xMin=256,KanjiCanvas.xMax=0,KanjiCanvas.yMin=256,KanjiCanvas.yMax=0;for(var n=0;n<KanjiCanvas["recordedPattern_"+a].length;n++)for(var i=KanjiCanvas["recordedPattern_"+a][n],e=0;e<i.length;e++)KanjiCanvas.x=i[e][0],KanjiCanvas.y=i[e][1],KanjiCanvas.x<KanjiCanvas.xMin&&(KanjiCanvas.xMin=KanjiCanvas.x),KanjiCanvas.x>KanjiCanvas.xMax&&(KanjiCanvas.xMax=KanjiCanvas.x),KanjiCanvas.y<KanjiCanvas.yMin&&(KanjiCanvas.yMin=KanjiCanvas.y),KanjiCanvas.y>KanjiCanvas.yMax&&(KanjiCanvas.yMax=KanjiCanvas.y);KanjiCanvas.oldHeight=Math.abs(KanjiCanvas.yMax-KanjiCanvas.yMin),KanjiCanvas.oldWidth=Math.abs(KanjiCanvas.xMax-KanjiCanvas.xMin);var s=KanjiCanvas.aran(KanjiCanvas.oldWidth,KanjiCanvas.oldHeight),r=KanjiCanvas.newWidth,t=KanjiCanvas.newHeight;KanjiCanvas.oldHeight>KanjiCanvas.oldWidth?r=s*KanjiCanvas.newWidth:t=s*KanjiCanvas.newHeight;var v=(KanjiCanvas.newWidth-r)/2,C=(KanjiCanvas.newHeight-t)/2,j=KanjiCanvas.m00(KanjiCanvas["recordedPattern_"+a]),K=KanjiCanvas.m01(KanjiCanvas["recordedPattern_"+a]),o=KanjiCanvas.m10(KanjiCanvas["recordedPattern_"+a])/j,c=K/j,f=r/2,d=t/2,l=KanjiCanvas.mu20(KanjiCanvas["recordedPattern_"+a],o),u=KanjiCanvas.mu02(KanjiCanvas["recordedPattern_"+a],c),h=r/(4*Math.sqrt(l/j))||0,_=t/(4*Math.sqrt(u/j))||0,g=new Array;for(n=0;n<KanjiCanvas["recordedPattern_"+a].length;n++){var x=KanjiCanvas["recordedPattern_"+a][n],p=new Array;for(e=0;e<x.length;e++){var M=h*(x[e][0]-o)+f,y=_*(x[e][1]-c)+d;p.push([M,y])}g.push(p)}return KanjiCanvas.transform(g,v,C)},KanjiCanvas.euclid=function(a,n){var i=a[0]-n[0],e=a[1]-n[1];return Math.sqrt(i*i+e*e)},KanjiCanvas.extractFeatures=function(a,n){for(var i=new Array,e=a.length,s=0;s<e;s++){for(var r=a[s],t=new Array,v=0,C=0;C<r.length;){if(0==C){var j=r[0];t.push(j)}if(C>0){j=r[C-1];var K=r[C];v+=KanjiCanvas.euclid(j,K)}if(v>=n&&C>1){v-=n;j=r[C];t.push(j)}C++}if(1==t.length){j=r[r.length-1];t.push(j)}else if(v>.75*n){j=r[r.length-1];t.push(j)}i.push(t)}return i},KanjiCanvas.endPointDistance=function(a,n){var i=0,e=void 0===a?0:a.length,s=void 0===n?0:n.length;if(0==e||0==s)return 0;var r=a[0],t=n[0];return i+=Math.abs(r[0]-t[0])+Math.abs(r[1]-t[1]),r=a[e-1],t=n[s-1],i+=Math.abs(r[0]-t[0])+Math.abs(r[1]-t[1])},KanjiCanvas.initialDistance=function(a,n){for(var i=a.length,e=n.length,s=Math.min(i,e),r=Math.max(i,e),t=0,v=0;v<s;v++){var C=a[v],j=n[v];t+=Math.abs(C[0]-j[0])+Math.abs(C[1]-j[1])}return t*(r/s)},KanjiCanvas.getLargerAndSize=function(a,n){var i=void 0===a?0:a.length,e=void 0===n?0:n.length,s=i,r=e,t=a,v=n;return i<e&&(r=i,s=e,t=n,v=a),[t,v,s,r]},KanjiCanvas.wholeWholeDistance=function(a,n){for(var i=KanjiCanvas.getLargerAndSize(a,n),e=0,s=0;s<i[3];s++){KanjiCanvas.j_of_i=parseInt(parseInt(i[2]/i[3])*s);var r=i[0][KanjiCanvas.j_of_i],t=i[1][s];e+=Math.abs(r[0]-t[0])+Math.abs(r[1]-t[1])}return parseInt(e/i[3])},KanjiCanvas.initStrokeMap=function(a,n,i){for(var e=KanjiCanvas.getLargerAndSize(a,n),s=new Array,r=0;r<e[2];r++)s[r]=-1;var t=new Array;for(r=0;r<e[2];r++)t[r]=!0;for(r=0;r<e[3];r++){KanjiCanvas.minDist=1e7,KanjiCanvas.min_j=-1;for(var v=0;v<e[2];v++)if(1==t[v]){var C=i(e[0][v],e[1][r]);C<KanjiCanvas.minDist&&(KanjiCanvas.minDist=C,KanjiCanvas.min_j=v)}t[KanjiCanvas.min_j]=!1,s[KanjiCanvas.min_j]=r}return s},KanjiCanvas.getMap=function(a,n,i){for(var e=KanjiCanvas.getLargerAndSize(a,n),s=KanjiCanvas.initStrokeMap(e[0],e[1],i),r=0;r<3;r++)for(var t=0;t<s.length;t++)if(-1!=s[t]){KanjiCanvas.dii=i(e[0][t],e[1][s[t]]);for(var v=0;v<s.length;v++)if(-1!=s[t])if(-1!=s[v]){var C=i(e[0][v],e[1][s[v]]),j=i(e[0][v],e[1][s[t]]);if(i(e[0][t],e[1][s[v]])+j<KanjiCanvas.dii+C){var K=s[v];s[v]=s[t],s[t]=K,KanjiCanvas.dii=j}}else{(j=i(e[0][v],e[1][s[t]]))<KanjiCanvas.dii&&(s[v]=s[t],s[t]=-1,KanjiCanvas.dii=j)}}return s},KanjiCanvas.completeMap=function(a,n,i,e){var s=KanjiCanvas.getLargerAndSize(a,n);if(!e.includes(-1))return e;for(var r=e[e.length],t=-1,v=e.length-1;v>=0;v--){if(-1!=e[v]){t=e[v];break}r=v}for(v=r;v<e.length;v++)e[v]=t;var C=-1,j=-1;for(v=0;v<e.length;v++){if(-1!=e[v]){j=e[v];break}C=v}for(v=0;v<=C;v++)e[v]=j;for(v=0;v<e.length;v++)if(v+1<e.length&&-1==e[v+1]){for(var K=v,o=v+1;o<e.length&&-1==e[o];)o++;for(var c=K,f=1e6,d=K;d<o;d++){for(var l=s[0][K],u=K+1;u<=d;u++)l=l.concat(s[0][u]);var h=s[0][d+1];for(u=d+2;u<=o;u++)h=h.concat(s[0][u]);var _=i(l,s[1][e[K]]),g=i(h,s[1][e[o]]);_+g<f&&(c=d,f=_+g)}for(d=K;d<=c;d++)e[d]=e[K];for(d=c+1;d<o;d++)e[d]=e[o]}return e},KanjiCanvas.computeDistance=function(a,n,i,e){for(var s=KanjiCanvas.getLargerAndSize(a,n),r=0,t=0;t<s[2];){for(var v=s[1][e[t]],C=t,j=C+1;j<e.length&&e[j]==e[t];)j++;for(var K=s[0][C],o=C+1;o<j;o++)K=K.concat(s[0][o]);r+=i(v,K),t=j}return r},KanjiCanvas.computeWholeDistanceWeighted=function(a,n,i){for(var e=KanjiCanvas.getLargerAndSize(a,n),s=0,r=0;r<e[2];){for(var t=e[1][i[r]],v=r,C=v+1;C<i.length&&i[C]==i[r];)C++;for(var j=e[0][v],K=v+1;K<C;K++)j=j.concat(e[0][K]);var o=KanjiCanvas.wholeWholeDistance(t,j);if(C>v+1){var c=void 0===t?0:t.length,f=j.length;if(f<c){K=f;f=c,c=K}o*=f/c}s+=o,r=C}return s},KanjiCanvas.coarseClassification=function(a){for(var n=a.length,i=[],e=0;e<KanjiCanvas.refPatterns.length;e++){var s=KanjiCanvas.refPatterns[e][1];if(n<s+2&&n>s-3){var r=KanjiCanvas.refPatterns[e][2],t=KanjiCanvas.getMap(r,a,KanjiCanvas.endPointDistance);t=KanjiCanvas.completeMap(r,a,KanjiCanvas.endPointDistance,t);var v=KanjiCanvas.computeDistance(r,a,KanjiCanvas.endPointDistance,t),C=s,j=r.length;if(j<C){var K=j;j=C,C=K}i.push([e,v*(C/j)])}}return i.sort(function(a,n){return a[1]-n[1]}),i},KanjiCanvas.fineClassification=function(a,n){for(var i=a.length,e=[],s=0;s<Math.min(n.length,100);s++){var r=n[s][0],t=KanjiCanvas.refPatterns[r][1],v=KanjiCanvas.refPatterns[r][2];if(i<t+2&&i>t-3){var C=KanjiCanvas.getMap(v,a,KanjiCanvas.initialDistance);C=KanjiCanvas.completeMap(v,a,KanjiCanvas.wholeWholeDistance,C),"委"==KanjiCanvas.refPatterns[r][0]&&(console.log("finished imap, fine:"),console.log(C),console.log("weight:"),console.log(KanjiCanvas.computeDistance(v,a,KanjiCanvas.wholeWholeDistance,C)),console.log("weight intended:"),console.log(KanjiCanvas.computeDistance(v,a,KanjiCanvas.wholeWholeDistance,[0,1,2,3,4,7,5,6])));var j=KanjiCanvas.computeWholeDistanceWeighted(v,a,C),K=i,o=v.length;o>K&&(o=K),j/=o,e.push([r,j])}}e.sort(function(a,n){return a[1]-n[1]});var c="";for(s=0;s<Math.min(e.length,10);s++)c+=KanjiCanvas.refPatterns[e[s][0]][0],c+="  ";return c},KanjiCanvas.recognize=function(a){var n=KanjiCanvas.momentNormalize(a),i=KanjiCanvas.extractFeatures(n,20),e=KanjiCanvas.getMap(i,KanjiCanvas.refPatterns[0][2],KanjiCanvas.endPointDistance);e=KanjiCanvas.completeMap(i,KanjiCanvas.refPatterns[0][2],KanjiCanvas.endPointDistance,e);var s=KanjiCanvas.coarseClassification(i);return KanjiCanvas.redraw(a),KanjiCanvas.fineClassification(i,s)},KanjiCanvas.copyStuff=function(a){KanjiCanvas.s="";for(var n=0,i=KanjiCanvas["recordedPattern_"+a].length;n<i;n++)console.log(n+1,KanjiCanvas["recordedPattern_"+a][n],KanjiCanvas["recordedPattern_"+a][n].toString()),console.log(KanjiCanvas["recordedPattern_"+a][n]),console.log(JSON.stringify(KanjiCanvas["recordedPattern_"+a][n])),KanjiCanvas.s+="["+JSON.stringify(KanjiCanvas["recordedPattern_"+a][n])+"],";KanjiCanvas.copyToClipboard(KanjiCanvas.s)},KanjiCanvas.copyToClipboard=function(a){var i=n.createElement("textarea");i.value=a,n.body.appendChild(i),i.select(),n.execCommand("copy"),n.body.removeChild(i)},n.addEventListener("keydown",function(i){var e=n.activeElement.id;if(KanjiCanvas["canvas_"+e]&&i.ctrlKey)switch(i.key.toLowerCase()){case"z":i.preventDefault(),KanjiCanvas.deleteLast(e);break;case"x":i.preventDefault(),KanjiCanvas.erase(e);break;case"f":/debug/.test(a.location.search)&&(i.preventDefault(),console.log(KanjiCanvas.recognize(e)))}})}(window,document);